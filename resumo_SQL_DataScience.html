<!DOCTYPE html>
<html>
<head>
<title>resumo_SQL_DataScience.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<!-- TOC -->
<ul>
<li><a href="#resumo-sql">Resumo SQL</a>
<ul>
<li><a href="#defini%C3%A7%C3%A3o">Definição</a></li>
<li><a href="#o-modelo-entidade-relacional-mer">O Modelo Entidade Relacional (MER)</a></li>
<li><a href="#a-estrutura-de-uma-consulta">A estrutura de uma consulta</a></li>
<li><a href="#a-jun%C3%A7%C3%A3o-de-tabelas">A junção de tabelas</a>
<ul>
<li><a href="#inner-join-1--1">INNER JOIN (1 : 1)</a></li>
<li><a href="#full-outer-join-m--n">FULL OUTER JOIN (M : N)</a></li>
<li><a href="#right-join-n--1">RIGHT JOIN (N : 1)</a></li>
<li><a href="#left-join-1--n">LEFT JOIN (1 : N)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#subqueries">Subqueries</a>
<ul>
<li><a href="#subquery-no-where">Subquery no <em>WHERE</em></a></li>
<li><a href="#subquery-no-select">Subquery no <em>SELECT</em></a></li>
<li><a href="#subquery-no-from">Subquery no <em>FROM</em></a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="resumo-sql">Resumo SQL</h1>
<p>Bruno Piato - 22 de fevereito de 2023</p>
<h2 id="defini%C3%A7%C3%A3o">Definição</h2>
<p>O SQL, ou , <em>Structured Query Language</em> é uma linguagem de acesso e consulta a bancos de dados relacionais, isto é, que seja composto por tabelas que se conectam através de chaves mapeadas no Modelo Entidade-Relacional (MER).
<br></br></p>
<h2 id="o-modelo-entidade-relacional-mer">O Modelo Entidade Relacional (MER)</h2>
<p>O MER é um diagrama que mapeia as relaçoes entre as entidades (tabelas) de um banco de dados relacional através das chaves estrangeiras que as ligam.
<br></br></p>
<p><img src="https://i.imgur.com/HRhd2Y0.png" alt="Modelo Entidade-Relacional (MER)">
<figcaption align = "center"><b>Fig.1 - Modelo Entidade-Relacional (MER)</b></figcaption></p>
<br>
<h2 id="a-estrutura-de-uma-consulta">A estrutura de uma consulta</h2>
<p>As consultas SQL possuem a anatomia: CLÁUSULA &gt; OPERADORES.</p>
<p>As principais cláusulas são:</p>
<ul>
<li><strong>SELECT</strong>: seleciona as colunas de uma tabela. Para selecionar todas as linhas, usamos o <em>SELECT *</em>.</li>
<li><strong>FROM</strong>: seleciona a tabela de um banco de dados.</li>
<li><strong>WHERE</strong>: seleciona as linhas de uma tabela.</li>
<li><strong>GROUP BY</strong>: agrupa as linhas de acordo com as categorias de uma variável.</li>
<li><strong>ORDER BY</strong>: ordena as linhas de acordo com as categorias de uma variável.</li>
</ul>
<p>Os principais operadores são:</p>
<ul>
<li>Operadores de agregação (usados na clásula <strong>SELECT</strong>):
<ul>
<li><strong>SUM</strong>: soma as colunas.</li>
<li><strong>MIN</strong>: encontra o valor mínimo de uma coluna.</li>
<li><strong>MAX</strong>: encontra o valor máximo de uma coluna.</li>
<li><strong>AVG</strong>: encontra o valor médio de uma coluna.</li>
<li><strong>COUNT</strong>: conta as entradas de uma coluna.</li>
<li><strong>DISTINCT</strong>: encontra os valor distintos de uma coluna.</li>
</ul>
</li>
</ul>
<br>
<ul>
<li>Operadores de intervalo (usados na cláusula <strong>WHERE</strong>):
<ul>
<li><strong>BETWEEN</strong> e <strong>NOT BETWEEN</strong>: seleciona as linhas cujo valor para uma variável esteja (ou não) em um intervalo determinado.</li>
<li><strong>IN</strong> e <strong>NOT IN</strong>: seleciona as linhas cujo valor para uma variável esteja (ou não) em uma lista de valores determinada.</li>
<li><strong>LIKE</strong> e <strong>NOT LIKE</strong>: seleciona as linhas cujo valor para uma variável apresente (ou não) um determinado padrão estipulado</li>
<li><strong>HAVING</strong>: seleciona as linhas cujo valor para uma variável agregada apresente (ou não) um valor determinado.</li>
</ul>
</li>
</ul>
<br>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
    <span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">col</span>)
    <span class="hljs-keyword">MIN</span>(<span class="hljs-keyword">col</span>)
    <span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">col</span>)
    <span class="hljs-keyword">AVG</span>(<span class="hljs-keyword">col</span>)
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">col</span>)
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">col</span>)
<span class="hljs-keyword">FROM</span> tabela
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">var</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">var</span> <span class="hljs-keyword">ASC</span>/<span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">WHERE</span>
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">BETWEEN</span> X <span class="hljs-keyword">AND</span> Y
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">BETWEEN</span> X <span class="hljs-keyword">AND</span> Y
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">IN</span> (A, B, C)
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (A, B, C)
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%@gmail.com'</span>
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'auto%'</span>
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">col</span>) &gt;= x
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
    <span class="hljs-keyword">LIMIT</span> n
</div></code></pre>
<br>
<h2 id="a-jun%C3%A7%C3%A3o-de-tabelas">A junção de tabelas</h2>
<p>As tabelas podem ser unidas de acordo com sua cardinalidade, isto é, de acordo com a arquitetura de união pré-estipulada para elas. Há três formas de cardinalidade:</p>
<ul>
<li><strong>Um para um (1:1)</strong>: cada linha de uma tabela tem uma e somente uma linha correspondente na outra tabela.</li>
<li><strong>Um para vários (1:N)</strong>: cada linha de uma tabela pode ter várias linhas correspondentes na outra tabela.</li>
<li><strong>Vários para vários (M:N)</strong>: várias linhas de uma tabela podem ter várias linhas correspondentes da outra tabela.</li>
</ul>
<br>
<h3 id="inner-join-1--1">INNER JOIN (1 : 1)</h3>
<p>Realiza uma junção de um para um em que são retornada apenas as linhas que tiverem  uma, e apenas uma,  conexão entre as tabelas.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> linhas
<span class="hljs-keyword">FROM</span> tabela1 t1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> tabela2 t2 <span class="hljs-keyword">ON</span> (t1.chave = t2.chave)
               <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> tabela3 t2 <span class="hljs-keyword">ON</span> (t1.chave2 = t3.chave2)
</div></code></pre>
<h3 id="full-outer-join-m--n">FULL OUTER JOIN (M : N)</h3>
<p>Realiza uma junção de vários para vários em que são retornadas todas as linhas de ambas as tabelas. Caso não haja conexão entre algumas linhas das tabelas, é imputado valor nulo para a conexão.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> linhas
<span class="hljs-keyword">FROM</span> tabela1 t1 <span class="hljs-keyword">FULL</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> tabela2 t2 <span class="hljs-keyword">ON</span> (t1.chave = t2.chave)
</div></code></pre>
<h3 id="right-join-n--1">RIGHT JOIN (N : 1)</h3>
<p>Realiza uma junção de vários para um em que será usada como base a tabela da direita, retornando todas as conexões da tabela da esquerda que tenham base na direita. Caso não haja conexão entre algumas linhas das tabelas, é imputado valor nulo para a conexão.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> linhas
<span class="hljs-keyword">FROM</span> tabela1 t1 <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> tabela2 t2 <span class="hljs-keyword">ON</span> (t1.chave = t2.chave)
</div></code></pre>
<h3 id="left-join-1--n">LEFT JOIN (1 : N)</h3>
<p>Realiza uma junção de vários para um em que será usada como base a tabela da esquerda, retornando todas as conexões da tabela da direita que tenham base na esquerda. Caso não haja conexão entre algumas linhas das tabelas, é imputado valor nulo para a conexão.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> linhas
<span class="hljs-keyword">FROM</span> tabela1 t1 <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> tabela2 t2 <span class="hljs-keyword">ON</span> (t1.chave = t2.chave)
</div></code></pre>
<hr>
<h1 id="subqueries">Subqueries</h1>
<p>Subqueries são consultas, transformações e filtragens realizadas nas tabelas anteriormente à consulta principal, permitindo que as junções de tabelas ocorram com os resultados destas transformações. Há três formas de realizar subqueries:</p>
<ul>
<li>Subqueries no <strong>WHERE</strong>: podemos usar o operador <em>IN</em> para filtrar uma tabela e, dentro do <em>IN</em> colocar uma query (subquery, neste caso) para selecionar as linhas a serem filtradas.</li>
<li>Subqueries no <strong>SELECT</strong>: usamos este tipo quando queremos que o resultado da subquery figure como uma nova coluna na tabela principal. Podemos fazer a subquery retornar os próprios valores da variável como estão na tabela de origem (como se fosse um JOIN) ou podemos fazer a subquery retonar o resultado de funções de agregação.</li>
<li>Subqueries no <strong>FROM</strong>: permitem processar toda uma tabela antes de usá-la e uni-la com outras tabelas, unindo somente seus resultados. É muito útil quando precisamos usar poucas variáveis de muitas tabelas diferentes, de modo que realizar o <em>JOIN</em> se tornaria muito dispendioso.</li>
</ul>
<h2 id="subquery-no-where">Subquery no <em>WHERE</em></h2>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
    oi.product_id,
    <span class="hljs-keyword">AVG</span>(oi.price)
<span class="hljs-keyword">FROM</span> 
    order_items oi
<span class="hljs-keyword">WHERE</span>
    oi.product_id <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> 
                          p.product_id
                      <span class="hljs-keyword">FROM</span> 
                          products p
                      <span class="hljs-keyword">WHERE</span> 
                        p.product_category_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'arte'</span>, <span class="hljs-string">'perfumaria'</span>))
</div></code></pre>
<h2 id="subquery-no-select">Subquery no <em>SELECT</em></h2>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
    p.product_id,
    p.product_name,
    (<span class="hljs-keyword">SELECT</span>
        <span class="hljs-keyword">AVG</span>(r.reviews)
    <span class="hljs-keyword">FROM</span>
        reviews r
    <span class="hljs-keyword">WHERE</span> 
        p.product_id = r.product_id) <span class="hljs-keyword">AS</span> avg_review
<span class="hljs-keyword">FROM</span>
  products p
</div></code></pre>
<h2 id="subquery-no-from">Subquery no <em>FROM</em></h2>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span>
    order_status,
    num_pedidos,
    sum_prices,
    avg_prices
<span class="hljs-keyword">FROM</span> ( <span class="hljs-keyword">SELECT</span>
          o.order_status,
          <span class="hljs-keyword">COUNT</span>( oi.order_id ) <span class="hljs-keyword">AS</span> num_pedidos,
          <span class="hljs-keyword">SUM</span>( oi.price ) <span class="hljs-keyword">AS</span> sum_prices,
          <span class="hljs-keyword">AVG</span>( oi.price ) <span class="hljs-keyword">AS</span> avg_prices
      <span class="hljs-keyword">FROM</span> 
          orders o <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> order_items oi <span class="hljs-keyword">ON</span> ( oi.order_id = o.order_id )
      <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
          o.order_status )
</div></code></pre>

</body>
</html>
